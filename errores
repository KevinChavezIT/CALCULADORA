# ============================================
# VERSION SIMPLIFICADA - Ejecutar macro específica
# ============================================

$excelPath = "C:\nmon-Vios\nmon analyser v69_2 2.xlsm"

try {
    $excel = New-Object -ComObject Excel.Application
    $excel.Visible = $true  # Déjalo visible para ver qué pasa
    $workbook = $excel.Workbooks.Open($excelPath)
    
    # IMPORTANTE: Debes habilitar macros manualmente la primera vez
    Write-Host "Por favor, habilita las macros en Excel si aparece una advertencia..." -ForegroundColor Yellow
    Write-Host "Luego presiona Enter aquí para continuar..." -ForegroundColor Yellow
    Read-Host
    
    # Ejecutar la macro (ajusta el nombre según lo que veas en Excel)
    $excel.Run("'nmon analyser v69_2 2.xlsm'!Button2_Click")
    
    Write-Host "Macro ejecutada. Esperando 2 minutos..." -ForegroundColor Green
    Start-Sleep -Seconds 120
    
    $workbook.Save()
    $workbook.Close()
    $excel.Quit()
    
    Write-Host "Completado!" -ForegroundColor Green
    
} catch {
    Write-Host "Error: $_" -ForegroundColor Red
}